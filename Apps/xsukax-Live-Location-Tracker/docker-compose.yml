name: xsukax-live-location-tracker
services:
  app:
    image: trafex/php-nginx:latest
    container_name: live-location-tracker
    restart: unless-stopped
    user: root
    ports:
      - target: 8080
        published: 8908
        protocol: tcp
    volumes:
      - type: bind
        source: /DATA/AppData/live-location-tracker
        target: /var/www/html
    entrypoint: /bin/sh
    command:
      - -c
      - |
        apk add --no-cache php84-session git
        if [ ! -f /var/www/html/index.php ]; then
          git clone --depth 1 https://github.com/xsukax/xsukax-Live-Location-Tracker.git /tmp/tracker
          cp -r /tmp/tracker/* /var/www/html/
          rm -rf /tmp/tracker
        fi
        chown -R nginx:nginx /var/www/html
        chmod -R 755 /var/www/html
        chmod 775 /var/www/html
        echo "memory_limit = 128M" > /etc/php84/conf.d/tracker.ini
        echo "max_execution_time = 60" >> /etc/php84/conf.d/tracker.ini
        echo "max_input_time = 60" >> /etc/php84/conf.d/tracker.ini
        echo "session.save_path = /tmp" >> /etc/php84/conf.d/tracker.ini
        echo "[www]" > /etc/php84/php-fpm.d/www.conf
        echo "user = nginx" >> /etc/php84/php-fpm.d/www.conf
        echo "group = nginx" >> /etc/php84/php-fpm.d/www.conf
        echo "listen = /run/php-fpm.sock" >> /etc/php84/php-fpm.d/www.conf
        echo "listen.owner = nginx" >> /etc/php84/php-fpm.d/www.conf
        echo "listen.group = nginx" >> /etc/php84/php-fpm.d/www.conf
        echo "listen.mode = 0660" >> /etc/php84/php-fpm.d/www.conf
        echo "pm = dynamic" >> /etc/php84/php-fpm.d/www.conf
        echo "pm.max_children = 5" >> /etc/php84/php-fpm.d/www.conf
        echo "pm.start_servers = 2" >> /etc/php84/php-fpm.d/www.conf
        echo "pm.min_spare_servers = 1" >> /etc/php84/php-fpm.d/www.conf
        echo "pm.max_spare_servers = 3" >> /etc/php84/php-fpm.d/www.conf
        echo c2VydmVyIHsKICAgIGxpc3RlbiA4MDgwIGRlZmF1bHRfc2VydmVyOwogICAgc2VydmVyX25hbWUgXzsKICAgIHJvb3QgL3Zhci93d3cvaHRtbDsKICAgIGluZGV4IGluZGV4LnBocDsKCiAgICBsb2NhdGlvbiAvIHsKICAgICAgICB0cnlfZmlsZXMgJHVyaSAkdXJpLyAvaW5kZXgucGhwPyRxdWVyeV9zdHJpbmc7CiAgICB9CgogICAgbG9jYXRpb24gfiBcLnBocCQgewogICAgICAgIGZhc3RjZ2lfcGFzcyB1bml4Oi9ydW4vcGhwLWZwbS5zb2NrOwogICAgICAgIGZhc3RjZ2lfcGFyYW0gU0NSSVBUX0ZJTEVOQU1FICRkb2N1bWVudF9yb290JGZhc3RjZ2lfc2NyaXB0X25hbWU7CiAgICAgICAgaW5jbHVkZSBmYXN0Y2dpX3BhcmFtczsKICAgIH0KCiAgICBsb2NhdGlvbiB+IC9cLiB7CiAgICAgICAgZGVueSBhbGw7CiAgICB9CgogICAgbG9jYXRpb24gfiBcLmpzb24kIHsKICAgICAgICBkZW55IGFsbDsKICAgIH0KfQo= | base64 -d > /etc/nginx/conf.d/default.conf
        nginx -t
        sed -i 's/^user=.*/user=nginx/' /etc/supervisor/conf.d/supervisord.conf
        exec /usr/bin/supervisord -c /etc/supervisor/conf.d/supervisord.conf
    x-casaos:
      volumes:
        - container: /var/www/html
          description:
            en_us: Application files and location data storage
      ports:
        - container: "8080"
          description:
            en_us: WebUI HTTP Port

x-casaos:
  architectures:
    - amd64
    - arm64
  main: app
  description:
    en_us: Real-time GPS location tracker with live sharing and journey replay. Share your location securely with family and friends through a simple shareable link. Features include live map tracking with OpenStreetMap, customizable update intervals (1-60 seconds), journey replay with speed controls, fullscreen map mode, and wake lock support to keep screen active during tracking. All location data is stored as JSON files with no database required.
  tagline:
    en_us: Real-time GPS location tracker with journey replay
  developer: xsukax
  author: xsukax
  icon: https://cdn-icons-png.flaticon.com/128/854/854878.png
  thumbnail: https://cdn-icons-png.flaticon.com/128/854/854878.png
  title:
    en_us: xsukax Live Location Tracker
  category: Utilities
  project_url: https://github.com/xsukax/xsukax-Live-Location-Tracker
  port_map: "8908"
